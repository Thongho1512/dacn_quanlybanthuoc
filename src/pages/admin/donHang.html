<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Qu·∫£n l√Ω ƒë∆°n h√†ng - H·ªá th·ªëng qu·∫£n l√Ω b√°n thu·ªëc" />
  <title>Qu·∫£n l√Ω ƒë∆°n h√†ng - AdminPro</title>

  <!-- CSS -->
  <link rel="stylesheet" href="../../css/reset.css" />
  <link rel="stylesheet" href="../../css/base.css" />
  <link rel="stylesheet" href="../../css/dashboard.css" />
  
  <style>
    /* Modal larger for this form */
    #order-modal .modal {
      max-width: 1200px !important;
    }

    /* Chi ti·∫øt ƒë∆°n h√†ng styles */
    .order-details-list {
      margin-top: 16px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      overflow-x: auto;
      background: white;
    }

    .order-detail-item {
      display: grid;
      grid-template-columns: 2.5fr 0.8fr 1.2fr 1.2fr 60px;
      gap: 12px;
      padding: 12px;
      border-bottom: 1px solid #f1f5f9;
      align-items: center;
      min-width: 800px;
    }

    .order-detail-item:last-child {
      border-bottom: none;
    }

    .order-detail-header {
      background: #f8fafc;
      font-weight: 600;
      color: #475569;
      font-size: 13px;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .form-select-small, .form-input-small {
      padding: 8px 10px;
      font-size: 13px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      width: 100%;
      box-sizing: border-box;
    }

    .form-input-small:focus,
    .form-select-small:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .btn-remove {
      padding: 6px;
      background: #fee2e2;
      color: #dc2626;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s;
      white-space: nowrap;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-remove:hover {
      background: #fecaca;
      transform: scale(1.1);
    }

    .order-summary {
      margin-top: 24px;
      padding: 20px;
      background: #f8fafc;
      border-radius: 8px;
      border: 2px solid #e2e8f0;
    }

    .order-form {
      display: flex;
      flex-direction: column;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
      padding-top: 20px;
      border-top: 2px solid #e2e8f0;
      flex-shrink: 0;
      background: white;
      position: relative;
      bottom: auto;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      font-size: 15px;
    }

    .summary-row.total {
      border-top: 2px solid #cbd5e1;
      margin-top: 8px;
      padding-top: 16px;
      font-size: 18px;
      font-weight: 700;
      color: #1e293b;
    }

    .summary-label {
      color: #64748b;
      font-weight: 500;
    }

    .summary-value {
      font-weight: 600;
      color: #1e293b;
    }

    .summary-value.discount {
      color: #ef4444;
    }

    .summary-value.total {
      color: #16a34a;
      font-size: 20px;
    }

    .customer-points-info {
      margin-top: 8px;
      padding: 12px;
      background: #fef3c7;
      border: 1px solid #fbbf24;
      border-radius: 6px;
      font-size: 13px;
      color: #92400e;
    }

    .points-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      background: #fbbf24;
      color: white;
      border-radius: 12px;
      font-weight: 600;
      font-size: 12px;
    }

    .detail-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    .order-details-container {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-top: 12px;
    }

    .validation-note {
      margin-top: 12px;
      padding: 12px;
      background: #dbeafe;
      border: 1px solid #3b82f6;
      border-radius: 6px;
      font-size: 13px;
      color: #1e40af;
    }

    .validation-note ul {
      margin: 8px 0 0 20px;
    }

    .validation-note li {
      margin: 4px 0;
    }

    .branch-warning {
      margin-bottom: 12px;
      padding: 12px;
      background: #fef3c7;
      border: 1px solid #fbbf24;
      border-radius: 6px;
      font-size: 13px;
      color: #92400e;
      display: none;
    }

    /* Scrollable modal body */
    #order-modal .modal-body {
      max-height: calc(90vh - 200px);
      overflow-y: auto;
    }

    @media (max-width: 1024px) {
      .order-detail-item {
        grid-template-columns: 1fr;
        gap: 8px;
        min-width: auto;
      }

      .detail-grid {
        grid-template-columns: 1fr;
      }

      #order-modal .modal {
        max-width: 95% !important;
      }
    }

    @media (max-width: 768px) {
      .detail-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="dashboard-container">
    <div id="header"></div>
    
    <div class="main-layout">
      <div id="sidebar-container"></div>
      <div class="sidebar-overlay" id="sidebar-overlay"></div>

      <main class="content-area">
        <div class="page-header">
          <h1 class="page-title">üõí Qu·∫£n l√Ω ƒë∆°n h√†ng</h1>
          <p class="page-subtitle">T·∫°o v√† qu·∫£n l√Ω ƒë∆°n h√†ng b√°n thu·ªëc v·ªõi t√≠ch ƒëi·ªÉm th∆∞·ªüng</p>
        </div>

        <div class="toolbar">
          <div id="search-container"></div>

          <button class="btn btn-primary" id="add-order-btn">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
            </svg>
            T·∫°o ƒë∆°n h√†ng m·ªõi
          </button>
        </div>

        <div id="table-container"></div>
      </main>
    </div>

    <div id="footer"></div>
  </div>

  <div id="modal-root"></div>

  <!-- FORM TEMPLATE -->
  <template id="order-form-template">
    <form id="order-form" class="order-form">
      <!-- Grid 2 c·ªôt cho th√¥ng tin chung -->
      <div class="detail-grid">
        <!-- KH√ÅCH H√ÄNG -->
        <div class="form-group">
          <label class="form-label" for="idkhachHang">
            Kh√°ch h√†ng
          </label>
          <select class="form-select" id="idkhachHang" name="idkhachHang">
            <option value="">-- Kh√°ch v√£ng lai --</option>
          </select>
          <div id="customer-points-display" class="customer-points-info" style="display: none;">
            <strong>üíé ƒêi·ªÉm t√≠ch l≈©y hi·ªán t·∫°i:</strong> <span id="current-points">0</span> ƒëi·ªÉm
            <br />
            <small>
              ‚Ä¢ 1 ƒëi·ªÉm = 1,000 VNƒê gi·∫£m gi√°<br />
              ‚Ä¢ T√≠ch l≈©y: M·ªói 10,000 VNƒê = 1 ƒëi·ªÉm<br />
              ‚Ä¢ T·ªëi thi·ªÉu 10 ƒëi·ªÉm m·ªõi ƒë∆∞·ª£c s·ª≠ d·ª•ng<br />
              ‚Ä¢ Gi·∫£m t·ªëi ƒëa 50% gi√° tr·ªã ƒë∆°n h√†ng
            </small>
          </div>
        </div>

        <!-- CHI NH√ÅNH -->
        <div class="form-group">
          <label class="form-label" for="idchiNhanh">
            Chi nh√°nh <span class="required">*</span>
          </label>
          <select class="form-select" id="idchiNhanh" name="idchiNhanh" required>
            <option value="">-- Ch·ªçn chi nh√°nh --</option>
          </select>
          <small class="form-note" style="color: #64748b; font-size: 12px; display: block; margin-top: 4px;">
            Ch·ªçn chi nh√°nh ƒë·ªÉ xem thu·ªëc c√≥ s·∫µn t·∫°i kho
          </small>
        </div>
      </div>

      <!-- PH∆Ø∆†NG TH·ª®C THANH TO√ÅN -->
      <div class="form-group">
        <label class="form-label" for="idphuongThucTt">
          Ph∆∞∆°ng th·ª©c thanh to√°n <span class="required">*</span>
        </label>
        <select class="form-select" id="idphuongThucTt" name="idphuongThucTt" required>
          <option value="">-- Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n --</option>
        </select>
      </div>

      <!-- CHI TI·∫æT ƒê∆†N H√ÄNG -->
      <div class="form-group">
        <label class="form-label">
          Chi ti·∫øt ƒë∆°n h√†ng <span class="required">*</span>
        </label>

        <!-- TH√îNG B√ÅO CH·ªåN CHI NH√ÅNH -->
        <div id="branch-warning" class="branch-warning">
          <strong>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</strong> Vui l√≤ng ch·ªçn chi nh√°nh tr∆∞·ªõc ƒë·ªÉ xem danh s√°ch thu·ªëc c√≥ s·∫µn t·∫°i kho c·ªßa chi nh√°nh ƒë√≥.
        </div>
        
        <div class="validation-note">
          <strong>üí° H∆∞·ªõng d·∫´n:</strong>
          <ul>
            <li>Ch·ªçn thu·ªëc t·ª´ danh s√°ch c√≥ s·∫µn t·∫°i chi nh√°nh</li>
            <li>Nh·∫≠p s·ªë l∆∞·ª£ng c·∫ßn b√°n (t·ªëi thi·ªÉu 1)</li>
            <li>ƒê∆°n gi√° v√† th√†nh ti·ªÅn s·∫Ω t·ª± ƒë·ªông t√≠nh</li>
            <li>C√≥ th·ªÉ th√™m nhi·ªÅu thu·ªëc v√†o ƒë∆°n h√†ng</li>
          </ul>
        </div>
        
        <div class="order-details-container">
          <div class="order-details-list">
            <div class="order-detail-item order-detail-header">
              <div>Thu·ªëc</div>
              <div>S·ªë l∆∞·ª£ng</div>
              <div>ƒê∆°n gi√° (VNƒê)</div>
              <div>Th√†nh ti·ªÅn</div>
              <div></div>
            </div>
          </div>
        </div>

        <button type="button" class="btn btn-secondary" id="add-detail-btn" style="margin-top: 12px;">
          ‚ûï Th√™m thu·ªëc
        </button>
      </div>

      <!-- T·ªîNG K·∫æT ƒê∆†N H√ÄNG -->
      <div class="order-summary">
        <div class="summary-row">
          <span class="summary-label">T·ªïng ti·ªÅn h√†ng:</span>
          <span class="summary-value" id="summary-total">0 ‚Ç´</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Ti·ªÅn gi·∫£m gi√° (ƒêi·ªÉm t√≠ch l≈©y):</span>
          <span class="summary-value discount" id="summary-discount">0 ‚Ç´</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">S·ªë ƒëi·ªÉm s·ª≠ d·ª•ng:</span>
          <span class="summary-value" id="summary-points-used">0 ƒëi·ªÉm</span>
        </div>
        <div class="summary-row total">
          <span class="summary-label">Th√†nh ti·ªÅn:</span>
          <span class="summary-value total" id="summary-final">0 ‚Ç´</span>
        </div>
        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #cbd5e1; font-size: 13px; color: #64748b;">
          <strong>üìå L∆∞u √Ω:</strong>
          <ul style="margin: 8px 0 0 20px;">
            <li>H·ªá th·ªëng t·ª± ƒë·ªông √°p d·ª•ng ƒëi·ªÉm t√≠ch l≈©y t·ªëi ƒëa c·ªßa kh√°ch h√†ng</li>
            <li>ƒêi·ªÉm ƒë∆∞·ª£c s·ª≠ d·ª•ng t·ªëi ƒëa 50% gi√° tr·ªã ƒë∆°n h√†ng</li>
            <li>Kh√°ch h√†ng s·∫Ω ƒë∆∞·ª£c t√≠ch ƒëi·ªÉm m·ªõi sau khi thanh to√°n</li>
          </ul>
        </div>
      </div>

      <!-- FORM ACTIONS -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" id="cancel-btn" name="cancel-btn">
          H·ªßy
        </button>
        <button type="submit" class="btn btn-primary" id="submit-btn" name="submit-btn">
          <span class="btn-text">üíæ T·∫°o ƒë∆°n h√†ng</span>
          <span class="btn-loading" style="display: none">
            <span class="loading-spinner"></span> ƒêang x·ª≠ l√Ω...
          </span>
        </button>
      </div>
    </form>
  </template>

  <script type="module" src="../../js/pages/admin/donHang.js"></script>
</body>
</html>